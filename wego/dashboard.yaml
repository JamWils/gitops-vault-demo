apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: HelmRepository
metadata:
  name: weave-gitops-enterprise-charts
  namespace: flux-system
spec:
  interval: 60m
  secretRef:
    name: weave-gitops-enterprise-credentials
  url: https://charts.dev.wkp.weave.works/releases/charts-v3
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: weave-gitops-enterprise
  namespace: flux-system
spec:
  chart:
    spec:
      chart: mccp
      sourceRef:
        kind: HelmRepository
        name: weave-gitops-enterprise-charts
        namespace: flux-system
      version: v0.18.1
  install:
    crds: CreateReplace
  upgrade:
    crds: CreateReplace
  interval: 1m0s
  values:
    images:
      clusterBootstrapController: weaveworks/cluster-bootstrap-controller:v0.4.0
    enablePipelines: true
    enableTerraformUI: true
    enableRunUI: true
    service:
      type: ClusterIP
      ports:
        https: 8000
      targetPorts:
        https: 8000
    tls:
      enabled: false
    global:
      capiEnabled: false
      useK8sCachedClients: false
    config:
      capi:
        repositoryURL: https://github.com/JamWils/gitops-vault-demo
      cluster-controller:
        enabled: false
      git:
        type: github
        hostname: "github.com"
      # policy-agent:
      #   enabled: true
      #   accountId: test-id-123
      #   clusterId: cluster-id-123
      # oidc:
      #   enabled: "true"
      #   clientCredentialsSecret: dex-client-credentials
      #   issuerURL: https://dex-demo3.weavegitops.com
      #   redirectURL: https://demo3.weavegitops.com/oauth2/callback